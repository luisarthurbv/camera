version: '3.8'

services:
  db:
    image: postgres:15-alpine
    restart: always
    environment:
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-password}
      - POSTGRES_DB=${POSTGRES_DB:-camara_db}
    ports:
      - "${DB_PORT:-5432}:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  vector-admin-db:
    image: postgres:15-alpine
    restart: always
    environment:
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-password}
      - POSTGRES_DB=vector_admin
    ports:
      - "5433:5432"
    volumes:
      - vector_admin_db_data:/var/lib/postgresql/data

  chroma:
    image: chromadb/chroma:0.5.20
    restart: always
    ports:
      - "${CHROMA_PORT:-8123}:8000"
    volumes:
      - chroma_data:/chroma/chroma
    environment:
      - IS_PERSISTENT=TRUE
      - ANONYMIZED_TELEMETRY=FALSE

  vector-admin:
    image: mintplexlabs/vectoradmin:latest
    container_name: vector-admin
    ports:
      - "3001:3001"
    environment:
      - SERVER_PORT=3001
      - DATABASE_CONNECTION_STRING=postgres://${POSTGRES_USER:-postgres}:${POSTGRES_PASSWORD:-password}@vector-admin-db:5432/vector_admin
      - STORAGE_DIR=/app/storage
      - SYS_EMAIL=admin@admin.com
      - SYS_PASSWORD=admin
      - JWT_SECRET=${JWT_SECRET:-super-secret-key-change-me}
    volumes:
      - vector_admin_data:/app/storage
    depends_on:
      - vector-admin-db
    restart: always

volumes:
  postgres_data:
  chroma_data:
  vector_admin_data:
  vector_admin_db_data:
